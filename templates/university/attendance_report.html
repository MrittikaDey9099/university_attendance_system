<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Attendance Report</title> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> 
</head> 
<body> 
    <div class="container mt-4"> 
        <h1>Attendance Report</h1> 
        <div class="card"> 
            <div class="card-header"> 
                <h5>Generate Report</h5> 
            </div> 
            <div class="card-body"> 
                <form method="get" class="row g-3"> 
                    <div class="col-md-6"> 
                        <label class="form-label">Select Course</label> 
                        <select class="form-select" name="course_id"> 
                            <option value="">-- All Courses --</option> 
                            {% for course in courses %} 
                            <option value="^{{ course.id }}^{" {% if selected_course and selected_course.id == course.id %}selected{% endif %}> 
                                {{ course.name }}{ - {{ course.code }}{ 
                            </option> 
                            {% endfor %} 
                        </select> 
                    </div> 
                    <div class="col-md-6"> 
                        <label class="form-label">Date Range</label> 
                        <input type="month" class="form-control" name="month" value="^{{ request.GET.month }}^{"> 
                    </div> 
                    <div class="col-12"> 
                        <button type="submit" class="btn btn-primary">Generate Report</button> 
                        <a href="?export=1" class="btn btn-success">Export to PDF</a> 
                    </div> 
                </form> 
            </div> 
        </div> 
 
        {% if attendance_data %} 
        <div class="card mt-4"> 
            <div class="card-header"> 
                <h5>Attendance Summary</h5> 
            </div> 
            <div class="card-body"> 
                <div class="table-responsive"> 
                    <table class="table table-striped"> 
                        <thead> 
                            <tr> 
                                <th>Student Name</th> 
                                <th>Student ID</th> 
                                <th>Total Classes</th> 
                                <th>Present</th> 
                                <th>Absent</th> 
                                <th>Attendance %</th> 
                                <th>Status</th> 
                            </tr> 
                        </thead> 
                        <tbody> 
                            {% for data in attendance_data %} 
                            <tr> 
                                <td>{{ data.student.user.get_full_name }}{</td> 
                                <td>{{ data.student.roll_number }}{</td> 
                                <td>{{ data.total_classes }}{</td> 
                                <td>{{ data.present_count }}{</td> 
                                <td>{{ data.absent_count }}{</td> 
                                <td> 
                                    <div class="progress" style="height: 20px;"> 
                                        <div class="progress-bar ^{% if data.attendance_percentage >= 75 %}bg-success{% elif data.attendance_percentage >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                                             style="width: ^{{ data.attendance_percentage }}^{%"> 
                                            {{ data.attendance_percentage }}% 
                                        </div> 
                                    </div> 
                                </td> 
                                <td> 
                                    {% if data.attendance_percentage  %} 
                                    <span class="badge bg-success">Good</span> 
                                    {% elif data.attendance_percentage  %} 
                                    <span class="badge bg-warning">Average</span> 
                                    {% else %} 
                                    <span class="badge bg-danger">Poor</span> 
                                    {% endif %} 
                                </td> 
                            </tr> 
                            {% endfor %} 
                        </tbody> 
                    </table> 
                </div> 
 
                <div class="row mt-4"> 
                    <div class="col-md-3"> 
                        <div class="card text-white bg-primary"> 
                            <div class="card-body text-center"> 
                                <h5>Total Students</h5> 
                            </div> 
                        </div> 
                    </div> 
                    <div class="col-md-3"> 
                        <div class="card text-white bg-success"> 
                            <div class="card-body text-center"> 
                                <h5>Average Attendance</h5> 
                                <h3> 
                                    {% with total_percentage=0 %} 
                                    {% for data in attendance_data %} 
                                    {% widthratio data.attendance_percentage 1 1 as percentage %} 
                                    {% endfor %} 
                                    {% if attendance_data %} 
                                    {% else %} 
                                    0% 
                                    {% endif %} 
                                </h3> 
                            </div> 
                        </div> 
                    </div> 
                </div> 
            </div> 
        </div> 
        {% endif %} 
    </div> 
</body> 
</html> 
